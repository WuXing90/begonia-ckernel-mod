mark repo as unchanged
git stash

reset repo (DANGEROUS)
git restore .
git clean -fd

disable magisk check in anykernel package (not working)
NO_MAGISK_CHECK=1

add these kernel flags (helpful for kernel mod stuff)
CONFIG_KALLSYMS=y
CONFIG_KALLSYMS_ALL=y
CONFIG_OVERLAY_FS=y
CONFIG_TMPFS_XATTR=y

sukisu nongki
curl -LSs "https://raw.githubusercontent.com/SukiSU-Ultra/SukiSU-Ultra/main/kernel/setup.sh" | bash -s nongki

sukisu susfs main (not working :v)
curl -LSs "https://raw.githubusercontent.com/SukiSU-Ultra/SukiSU-Ultra/main/kernel/setup.sh" | bash -s susfs-main

backport kernel unmount
https://github.com/tiann/KernelSU/blob/main/website/docs/guide/how-to-integrate-for-non-gki.md
https://github.com/Nova-Kernels/kernel_xiaomi_mt6785/compare/fifteen-fixed...fifteen-fixed-ksu#diff-26b064824bfafef546f17235dc1f34dbea87ce6c27f9320b5d4427bfa4d2b0e9

our kernel
git clone https://github.com/Saikrishna1504/kernel_xiaomi_mt6785 -b bka --depth 1 kxm

susfs (prefer static commit)
mkdir susfs4ksu
cd susfs4ksu
git init
git remote add origin https://gitlab.com/simonpunk/susfs4ksu
git fetch --depth 1 origin 77905b5a071e6f3669e3b1814cea30147c0801da
git checkout FETCH_HEAD

get_cred_rcu function generated by susfs ksu integration code requiress some change_create (dev probably tried this with 32 bit kernel)
atomic_inc_not_zero > atomic_long_inc_not_zero


this susfs patch should be skipped due to manager validation method difference in sukisu
```diff
diff --git a/kernel/apk_sign.c b/kernel/apk_sign.c
index ba8b73f2..9af28285 100644
--- a/kernel/apk_sign.c
+++ b/kernel/apk_sign.c
@@ -314,7 +314,12 @@ module_param_cb(ksu_debug_manager_uid, &expected_size_ops,
 
 #endif
 
-bool is_manager_apk(char *path)
+bool ksu_is_manager_apk(char *path)
 {
+#ifdef CONFIG_KSU_SUSFS
+	return (check_v2_signature(path, EXPECTED_SIZE, EXPECTED_HASH) ||
+			check_v2_signature(path, 384, "7e0c6d7278a3bb8e364e0fcba95afaf3666cf5ff3c245a3b63c8833bd0445cc4")); // 5ec1cff
+#else
 	return check_v2_signature(path, EXPECTED_SIZE, EXPECTED_HASH);
+#endif
 }
\ No newline at end of file
```

TODO: https://github.com/backslashxx/KernelSU/issues/5 (minimize hook scope, there are hella lot of pretty ancient kernel patches!). sys_execve, sys_faccessat, sys_newfstatat, sys_read, and input_event

susfs-required-edits
in `apk_compat.c`, real function is `return check_v2_signature(path, false, NULL);` and `check_v2_signature(char *path, bool check_multi_manager, int *signature_index)` is expected
in `kernel_compat.c`, `int ksu_access_ok(const void *addr, unsigned long size)` function is not required anymore as the root solution already has it in `kernel_compat.h`. Alternative solution is to add `#undef ksu_access_ok` before function block line.

kernel failed to build due to undefined symbol (what? it compiles without problem tho...): 
ksu_is_ksu_domain in __ksu_is_allow_uid (kernel/allowlist.c) (related to kernel/selinux/selinux.c and .h)
on_post_fs_data in ksu_handle_prctl (kernel/core_hook.c) (related to kernel/ksud.c and .h)
ksu_getenforce in ksu_apply_kernelsu_rules as well as ksu_handle_sepolicy (kernel/selinux/rules.c) (related to kernel/selinux/selinux.c)

maybe i should adapterize some commands
is_ksu_domain -> ksu_is_ksu_domain
getenforce -> ksu_getenforce

sane backport!
https://github.com/tiann/KernelSU/issues/539#issuecomment-1763398054

this susfs module developer builds kernel with similar version as mine :)
https://github.com/sidex15/android_kernel_lge_sm8150

sidex15 has backport for susfs 1.5.9 (yay!). gotta try tomorrow!
https://github.com/sidex15/android_kernel_lge_sm8150/compare/c933d3f66675a6d39d91642b0f69c7735a5687ba...77ca28a53924b5d3c63f29a35c51422253771681
Kconfig import may be needed

EXPERIMENTAL by sudex15: sus_map
https://github.com/sidex15/android_kernel_lge_sm8150/compare/3b4aba477404c32bc03b98b84e20664369ac6e7f...3230d02a91e91f7466fed3ef7edc1220853d958b
same goes for this one

use this susfs patch
https://github.com/TheSillyOk/kernel_ls_patches/blob/master/susfs-1.5.12.patch

investigate some files
they have modified stuff here, so try to tweak it to accomodate susfs

Append begonia SKU to cmdline as needed
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/commit/f4ab697596a05ab4319f4b22cccdca753dac1020
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/blob/bka/fs/proc/cmdline.c

LineageOS spoofing
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/compare/b0f64f52d5d33dba921a95cd687aef568516f7e8...35a5bb4e00336becb8d297d11fb5663887ea7594
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/blob/bka/fs/proc/task_mmu.c
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/blob/bka/fs/proc/base.c

show_smap different from original version
around https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/commit/4c4acc4ebf506da995ebfc2e1cc420266cd8296a
https://github.com/Saikrishna1504/kernel_xiaomi_mt6785/blob/bka/fs/proc/base.c

their kernel latest commit has errors :v
should have done test compile
will wait for next stable releases

reboot handler is either `ksu_handle_sys_reboot` or `ksu_handle_reboot`, if earlier give undefined symbol error, use latter